---
import Layout from '../layouts/Layout.astro';
import SectionWrapper from '../../components/SectionWrapper.astro';
---

<Layout title="Admin Login">
  <SectionWrapper class="!pt-24 !pb-32">
    <div class="max-w-md mx-auto">
      <h1 class="font-serif text-4xl font-bold mb-8 text-center">Admin Login</h1>

      <div class="bg-white rounded-2xl p-8 border border-warm-beige">
        <form id="login-form" class="space-y-6">
          <div>
            <label for="email" class="block text-sm font-semibold mb-2 text-primary-teal">Email</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 border-2 border-warm-beige rounded-xl focus:border-primary-teal focus:outline-none transition"
              placeholder="admin@rootedsmile.com"
            />
          </div>

          <div>
            <label for="password" class="block text-sm font-semibold mb-2 text-primary-teal">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              class="w-full px-4 py-3 border-2 border-warm-beige rounded-xl focus:border-primary-teal focus:outline-none transition"
              placeholder="••••••••"
            />
          </div>

          <button
            type="submit"
            class="w-full bg-primary-teal text-soft-white px-8 py-4 rounded-full font-medium hover:bg-primary-teal/90 transition"
          >
            Sign In
          </button>
        </form>

        <div id="error-message" class="hidden mt-6 p-4 bg-terracotta/10 border border-terracotta rounded-xl">
          <p class="text-terracotta font-medium text-center text-sm"></p>
        </div>
      </div>
    </div>
  </SectionWrapper>
</Layout>

<script>
  import { auth } from '../../lib/firebase/client';
  import { signInWithEmailAndPassword } from 'firebase/auth';

  const form = document.getElementById('login-form') as HTMLFormElement;
  const errorMessage = document.getElementById('error-message');
  const errorText = errorMessage?.querySelector('p');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;

    try {
      await signInWithEmailAndPassword(auth, email, password);
      window.location.href = '/admin';
    } catch (error: any) {
      console.error('Login error:', error);
      
      let message = 'Invalid email or password. Please try again.';
      if (error.code === 'auth/user-not-found') {
        message = 'No account found with this email.';
      } else if (error.code === 'auth/wrong-password') {
        message = 'Incorrect password.';
      } else if (error.code === 'auth/too-many-requests') {
        message = 'Too many failed attempts. Please try again later.';
      }
      
      if (errorText) errorText.textContent = message;
      errorMessage?.classList.remove('hidden');
    }
  });
</script>
